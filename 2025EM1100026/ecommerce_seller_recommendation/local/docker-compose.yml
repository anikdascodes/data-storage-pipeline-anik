services:
  ecommerce-recommendation:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ecommerce_recommendation_system
    image: ecommerce-recommendation:latest
    volumes:
      - ./configs:/app/configs
      - ./src:/app/src
      - ./scripts:/app/scripts
      - ./raw:/app/raw
      - ./processed:/app/processed
      - ./quarantine:/app/quarantine
      - ./logs:/app/logs
    environment:
      - SPARK_HOME=/opt/spark
      - JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
      - PYSPARK_PYTHON=/usr/bin/python3
    working_dir: /app
    stdin_open: true
    tty: true
    # Note: Container will auto-execute all pipelines on startup
    # To run in interactive mode instead: docker compose run ecommerce-recommendation bash

# ============================================================
# Reviewer Quick Start:
# ============================================================
# 1. Build and run (auto-executes all pipelines):
#    docker compose up --build
#
# 2. Verify outputs (in another terminal):
#    docker compose exec ecommerce-recommendation bash /app/verify_outputs.sh
#
# 3. Stop container:
#    docker compose down
#
# ============================================================
# Advanced Usage:
# ============================================================
# Interactive mode (no auto-execution):
#    docker compose run --rm ecommerce-recommendation bash
#
# View logs:
#    docker compose logs -f
#
# Clean everything:
#    docker compose down -v && rm -rf processed/ quarantine/
# ============================================================
